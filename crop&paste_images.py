# -*- coding: utf-8 -*-
"""crop&paste_images.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/11ggrundzuWBM5DOEqWgzG2juQEe8yjiB
"""

from PIL import Image
import os
import matplotlib.pyplot as plt
import matplotlib.patches as patches
import time

# ==== ì‚¬ìš©ì ì„¤ì • ====
input_dir = "/content/drive/MyDrive/dataset/atm_dataset_1024x1024/front1_nick/rotation1"      # âœ… ì›ë³¸ ì´ë¯¸ì§€ í´ë” ê²½ë¡œ
output_dir = "/content/drive/MyDrive/rem/trainA"   # âœ… ê²°ê³¼ ì €ì¥ í´ë” ê²½ë¡œ

# ==== ë””ë ‰í† ë¦¬ ì¤€ë¹„ ====
os.makedirs(output_dir, exist_ok=True)

# ==== ì´ë¯¸ì§€ ëª©ë¡ í•„í„°ë§ ====
image_files = [f for f in sorted(os.listdir(input_dir)) if f.lower().endswith((".png", ".jpg", ".jpeg"))]
if not image_files:
    raise FileNotFoundError(f"{input_dir}ì— ìœ íš¨í•œ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.")

# ==== ì²« ë²ˆì§¸ ì´ë¯¸ì§€ë¡œ Crop ì¢Œí‘œ ì„¤ì • ====
first_img_path = os.path.join(input_dir, image_files[0])
img = Image.open(first_img_path)  # RGB ë³€í™˜ ìƒëµ

fig, ax = plt.subplots()
ax.imshow(img)
ax.set_xticks(range(0, img.width, 50))
ax.set_yticks(range(0, img.height, 50))
plt.grid(True)
plt.show()

# ğŸ”½ ì´ë¯¸ì§€ ìœ ì§€ ì‹œê°„
time.sleep(1)
plt.close(fig)

# ==== ì¢Œí‘œ ì…ë ¥ ====
x = int(input("Crop ì‹œì‘ x ì¢Œí‘œ: "))
y = int(input("Crop ì‹œì‘ y ì¢Œí‘œ: "))
size = int(input("Crop í¬ê¸° (ì •ì‚¬ê°í˜• í•œ ë³€): "))

# ==== ì‹œê°ì  í™•ì¸ ====
fig2, ax2 = plt.subplots()
ax2.imshow(img)
rect = patches.Rectangle((x, y), size, size, linewidth=2, edgecolor='red', facecolor='none')
ax2.add_patch(rect)
plt.grid(True)
plt.title("Crop ì˜ì—­ í™•ì¸ - 5ì´ˆ í›„ ìë™ ì¢…ë£Œ")
plt.show()

time.sleep(1)
plt.close(fig2)

# ==== ì¼ê´„ Crop ìˆ˜í–‰ ====
for fname in image_files:
    img_path = os.path.join(input_dir, fname)
    img = Image.open(img_path)
    cropped = img.crop((x, y, x + size, y + size))
    cropped.save(os.path.join(output_dir, fname))
    print(f"Saved: {fname}")

print(f"\nâœ… ëª¨ë“  Crop ì´ë¯¸ì§€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤: {output_dir}")

from PIL import Image
import os
from google.colab import drive


# ==== ì‚¬ìš©ì ì„¤ì • ====
background_dir = "/content/drive/MyDrive/dataset/atm_dataset_1024x1024/main/rotation3"   # ì •ìƒ ì´ë¯¸ì§€ ë””ë ‰í† ë¦¬
patch_dir = "/content/drive/MyDrive/result/train_set_10/main_rotation3/images/fake_B"        # ê²°í•¨ ì´ë¯¸ì§€ ë””ë ‰í† ë¦¬
output_dir = "/content/drive/MyDrive/nick_agu_10"       # ì €ì¥í•  ë””ë ‰í† ë¦¬
patch_resize_size = (50, 50)                                        # ë¶™ì´ê¸° ì „ ê²°í•¨ ì´ë¯¸ì§€ í¬ê¸°

# ==== ì €ì¥ ë””ë ‰í† ë¦¬ ìƒì„± ====
os.makedirs(output_dir, exist_ok=True)

# ==== íŒŒì¼ëª… ê¸°ì¤€ìœ¼ë¡œ 1:1 ë§¤ì¹­ ====
background_files = sorted([f for f in os.listdir(background_dir) if f.lower().endswith((".png", ".jpg", ".jpeg"))])
patch_files = sorted([f for f in os.listdir(patch_dir) if f.lower().endswith((".png", ".jpg", ".jpeg"))])

# ê³µí†µëœ íŒŒì¼ëª… ê¸°ì¤€ ë§¤í•‘
common_files = sorted(set(background_files) & set(patch_files))
if not common_files:
    raise ValueError("ë‘ ë””ë ‰í† ë¦¬ì— ê³µí†µëœ íŒŒì¼ëª…ì´ ì—†ìŠµë‹ˆë‹¤.")

# ==== ì‚¬ìš©ì ì…ë ¥: ë¶™ì¼ ìœ„ì¹˜ ====
patch_x = int(input("íŒ¨ì¹˜ x ì¢Œí‘œ ì…ë ¥: "))
patch_y = int(input("íŒ¨ì¹˜ y ì¢Œí‘œ ì…ë ¥: "))

# ==== ì´ë¯¸ì§€ íŒ¨ì¹˜ ì²˜ë¦¬ ====
for fname in common_files:
    bg_path = os.path.join(background_dir, fname)
    patch_path = os.path.join(patch_dir, fname)

    # ì´ë¯¸ì§€ ì—´ê¸°
    bg_img = Image.open(bg_path)
    patch_img = Image.open(patch_path)

    # íŒ¨ì¹˜ ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆ (50x50)
    patch_resized = patch_img.resize(patch_resize_size, Image.BICUBIC)

    # íŒ¨ì¹˜ ë¶™ì´ê¸°
    bg_img.paste(patch_resized, (patch_x, patch_y))

    # ì €ì¥
    save_path = os.path.join(output_dir, f"patched_{fname}")
    bg_img.save(save_path)
    print(f"âœ… Saved: {save_path}")